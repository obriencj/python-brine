<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Overview of python-brine &mdash; brine  documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="brine  documentation" href="../" />
    <link rel="next" title="brine package" href="../brine/" />
    <link rel="prev" title="Brine – Advanced pickling of functions for Python" href="../" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../brine/" title="brine package"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../" title="Brine – Advanced pickling of functions for Python"
             accesskey="P">previous</a> |</li>
        <li><a href="../">brine  documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="overview-of-python-brine">
<h1>Overview of python-brine<a class="headerlink" href="#overview-of-python-brine" title="Permalink to this headline">¶</a></h1>
<p>Brine is a <a class="reference external" href="http://python.org">Python</a> module that adds support for
the &#8220;true&#8221; pickling of functions. The default behavior of the
<a class="reference external" href="http://docs.python.org/2.7/library/pickle.html">pickle</a> library is
to reference functions by name alone. This presents a significant
problem when the function you wish to pickle is either anonymous or not
defined at the top level.</p>
<p>Brine provides a way to pickle the actual underlying code of a function,
including any captured cells, and then restore them again.</p>
<p>Brine also provides Barrel, which is a dictionary-like interface for
brining multiple functions. It allows shared resources to be pickled
while referring to each other (eg: mutually recursive inner functions).</p>
<p>I&#8217;ve set the version to 0.9.0 and will not be promising any API
stability until 1.0.0 is reached. That said, I do not believe it is too
terribly far off. Until such time as I set the API in stone, avoid
depending on this module for anything serious.</p>
<ul class="simple">
<li><a class="reference external" href="http://obriencj.preoccupied.net/python-brine/">python-brine
documentation</a></li>
<li><a class="reference external" href="https://github.com/obriencj/python-brine/">python-brine on
GitHub</a></li>
<li>python-brine not on PyPI until version 1.0.0</li>
</ul>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="http://python.org">Python</a> 2.6 or later (no support for Python 3,
the underlying function fields differ a bit)</li>
</ul>
</div>
<div class="section" id="install">
<h2>Install<a class="headerlink" href="#install" title="Permalink to this headline">¶</a></h2>
<p>This module uses setuptools, so simply run</p>
<div class="code bash highlight-python"><div class="highlight"><pre>python setup.py install
</pre></div>
</div>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>Before we begin, let&#8217;s contrive a function to preform the
pickle/unpickle dance, so we don&#8217;t have to write that over and over
again throughout these examples:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pickle</span> <span class="kn">import</span> <span class="n">Pickler</span><span class="p">,</span> <span class="n">Unpickler</span>
<span class="kn">from</span> <span class="nn">cStringIO</span> <span class="kn">import</span> <span class="n">StringIO</span>

<span class="k">def</span> <span class="nf">pickle_unpickle</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="nb">buffer</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
    <span class="n">Pickler</span><span class="p">(</span><span class="nb">buffer</span><span class="p">)</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="nb">buffer</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">(</span><span class="nb">buffer</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">Unpickler</span><span class="p">(</span><span class="nb">buffer</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</pre></div>
</div>
<div class="section" id="anonymous-or-inner-functions">
<h3>Anonymous or inner functions<a class="headerlink" href="#anonymous-or-inner-functions" title="Permalink to this headline">¶</a></h3>
<p>Pickle normally refuses to serialize a function that is not defined in
the top level. The <tt class="docutils literal"><span class="pre">BrineFunction</span></tt> class wraps a function in a manner
that supports pickling, and will actually put the code and cells into
the serialization stream.</p>
<p>We can use <tt class="docutils literal"><span class="pre">brine.brine</span></tt> to wrap a FunctionType instance, and
<tt class="docutils literal"><span class="pre">brine.unbrine</span></tt> to unwrap it again.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">brine</span> <span class="kn">import</span> <span class="n">brine</span><span class="p">,</span> <span class="n">unbrine</span>

<span class="c"># create a function that wouldn&#39;t normally be supported via pickle</span>
<span class="n">myfun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="s">&quot;Why hello there, </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">myfun</span><span class="p">(</span><span class="s">&quot;Godzilla&quot;</span><span class="p">)</span> <span class="c"># ==&gt; &quot;Why hello there, Godzilla&quot;</span>

<span class="c"># if we tried this without the brine/unbrine wrapping, we&#39;d get a</span>
<span class="c"># pickle.PicklingError raised all up in our biz</span>
<span class="n">myfun_redux</span> <span class="o">=</span> <span class="n">unbrine</span><span class="p">(</span><span class="n">pickle_unpickle</span><span class="p">(</span><span class="n">brine</span><span class="p">(</span><span class="n">myfun</span><span class="p">)))</span>

<span class="c"># this is now a copy of the original</span>
<span class="n">myfun_redux</span><span class="p">(</span><span class="s">&quot;Mothra&quot;</span><span class="p">)</span> <span class="c"># ==&gt; &quot;Why hello there, Mothra&quot;</span>
</pre></div>
</div>
<p>How about something with a captured value (a closure)?</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">make_myfun</span><span class="p">(</span><span class="n">who</span><span class="p">):</span>
    <span class="k">return</span> <span class="k">lambda</span><span class="p">:</span> <span class="p">(</span><span class="s">&quot;Why hello there, </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">who</span><span class="p">)</span>

<span class="n">myfun</span> <span class="o">=</span> <span class="n">make_myfun</span><span class="p">(</span><span class="s">&quot;Orion&quot;</span><span class="p">)</span>
<span class="n">myfun</span><span class="p">()</span> <span class="c"># ==&gt; &quot;Why hello there, Orion&quot;</span>

<span class="n">myfun_redux</span> <span class="o">=</span> <span class="n">unbrine</span><span class="p">(</span><span class="n">pickle_unpickle</span><span class="p">(</span><span class="n">brine</span><span class="p">(</span><span class="n">myfun</span><span class="p">)))</span>
<span class="n">myfun_redux</span><span class="p">()</span> <span class="c"># ==&gt; &quot;Why hello there, Orion&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="bound-instance-methods">
<h3>Bound instance methods<a class="headerlink" href="#bound-instance-methods" title="Permalink to this headline">¶</a></h3>
<p>Pickle normally refuses to serialize bound instance methods. This is
somewhat odd, because it can be done by name. The <tt class="docutils literal"><span class="pre">BrineMethod</span></tt> class
can be used to wrap a bound instance method. Note that because a bound
method needs to be associated with a object instance, that instance will
also need to support pickling (and hence, likely need to be defined at
the top level).</p>
<p>BrineMethod is name-based; it doesn&#8217;t try to pickle underlying class
code.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># setup a simple class for us to work over</span>
<span class="k">class</span> <span class="nc">Obj</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
    <span class="k">def</span> <span class="nf">set_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>

<span class="n">inst</span> <span class="o">=</span> <span class="n">Obj</span><span class="p">(</span><span class="s">&quot;Tacos&quot;</span><span class="p">)</span>
<span class="n">getter</span> <span class="o">=</span> <span class="n">inst</span><span class="o">.</span><span class="n">get_value</span>
<span class="n">setter</span> <span class="o">=</span> <span class="n">inst</span><span class="o">.</span><span class="n">set_value</span>

<span class="n">setter</span><span class="p">(</span><span class="s">&quot;Carrots&quot;</span><span class="p">)</span>
<span class="n">getter</span><span class="p">()</span> <span class="c"># ==&gt; &quot;Carrots&quot;</span>

<span class="c"># a little dance to brine and unbrine both bound methods</span>
<span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">getter</span><span class="p">,</span> <span class="n">setter</span><span class="p">)</span>
<span class="n">tmp</span> <span class="o">=</span> <span class="n">unbrine</span><span class="p">(</span><span class="n">pickle_unpickle</span><span class="p">(</span><span class="n">brine</span><span class="p">(</span><span class="n">tmp</span><span class="p">)))</span>
<span class="n">n_getter</span><span class="p">,</span> <span class="n">n_setter</span> <span class="o">=</span> <span class="n">tmp</span>

<span class="n">n_getter</span><span class="p">()</span> <span class="c"># ==&gt; &quot;Carrots&quot;</span>
<span class="n">n_setter</span><span class="p">(</span><span class="s">&quot;Sandwich&quot;</span><span class="p">)</span>
<span class="n">n_getter</span><span class="p">()</span> <span class="c"># ==&gt; &quot;Sandwich&quot;</span>

<span class="c"># the original is unaffected</span>
<span class="n">getter</span><span class="p">()</span> <span class="c"># ==&gt; &quot;Carrots&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="unit-testing">
<h2>Unit testing<a class="headerlink" href="#unit-testing" title="Permalink to this headline">¶</a></h2>
<p>I&#8217;ve setup <a class="reference external" href="https://travis-ci.org">travis-ci</a> and
<a class="reference external" href="https://coveralls.io">coveralls.io</a> for this project, so tests are
run automatically, and coverage is computed then. However, if you&#8217;d like
to run the tests manually, simply invoke them via</p>
<div class="code bash highlight-python"><div class="highlight"><pre>python setup.py test
</pre></div>
</div>
<p>You may check code coverage by use of
<a class="reference external" href="http://nedbatchelder.com/code/coverage/">coverage.py</a>, invoked as</p>
<div class="code bash highlight-python"><div class="highlight"><pre># generates coverage data in .coverage
coverage run --source=brine setup.py test

# creates an html report from the above in htmlcov/index.html
coverage html
</pre></div>
</div>
</div>
<div class="section" id="todo">
<h2>TODO<a class="headerlink" href="#todo" title="Permalink to this headline">¶</a></h2>
<p>The following tasks need to be taken care of before we reach the point
of tagging a 1.0.0 release and subsequently publishing to [PyPI].</p>
<ul class="simple">
<li>Should we allow users to extend BrineObject, in the same manner that
pickle can be (somewhat) extended today? TBD.</li>
</ul>
</div>
<div class="section" id="contact">
<h2>Contact<a class="headerlink" href="#contact" title="Permalink to this headline">¶</a></h2>
<p>Christopher O&#8217;Brien <a class="reference external" href="mailto:obriencj&#37;&#52;&#48;gmail&#46;com">obriencj<span>&#64;</span>gmail<span>&#46;</span>com</a></p>
</div>
<div class="section" id="license">
<h2>License<a class="headerlink" href="#license" title="Permalink to this headline">¶</a></h2>
<p>This library is free software; you can redistribute it and/or modify it
under the terms of the GNU Lesser General Public License as published by
the Free Software Foundation; either version 3 of the License, or (at
your option) any later version.</p>
<p>This library is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser
General Public License for more details.</p>
<p>You should have received a copy of the GNU Lesser General Public License
along with this library; if not, see <a class="reference external" href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Overview of python-brine</a><ul>
<li><a class="reference internal" href="#requirements">Requirements</a></li>
<li><a class="reference internal" href="#install">Install</a></li>
<li><a class="reference internal" href="#usage">Usage</a><ul>
<li><a class="reference internal" href="#anonymous-or-inner-functions">Anonymous or inner functions</a></li>
<li><a class="reference internal" href="#bound-instance-methods">Bound instance methods</a></li>
</ul>
</li>
<li><a class="reference internal" href="#unit-testing">Unit testing</a></li>
<li><a class="reference internal" href="#todo">TODO</a></li>
<li><a class="reference internal" href="#contact">Contact</a></li>
<li><a class="reference internal" href="#license">License</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../"
                        title="previous chapter">Brine &#8211; Advanced pickling of functions for Python</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../brine/"
                        title="next chapter">brine package</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/overview.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../brine/" title="brine package"
             >next</a> |</li>
        <li class="right" >
          <a href="../" title="Brine – Advanced pickling of functions for Python"
             >previous</a> |</li>
        <li><a href="../">brine  documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Author.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.1.
    </div>
  </body>
</html>